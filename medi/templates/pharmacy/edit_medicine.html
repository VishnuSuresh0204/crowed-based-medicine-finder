{% extends 'pharmacy/base.html' %}
{% block title %}Edit Medicine{% endblock %}
{% block content %}

<div style="max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <a href="/manage_medicine/" class="text-muted hover-text-primary" style="display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 500;">
            <i class="fas fa-arrow-left"></i> Back to Medicines
        </a>
    </div>

    <div class="glass-card" style="padding: 3rem;">
        <h2 class="text-center" style="margin-bottom: 2rem; font-size: 2.2rem; font-weight: 700;">
            <span class="text-gradient">Edit Medicine</span>
        </h2>
        
        {% if msg %}
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-circle" style="margin-right: 0.5rem;"></i> {{ msg }}
        </div>
        {% endif %}
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="grid-2">
                <div class="form-group">
                    <label><i class="fas fa-pills" style="margin-right: 8px; color: var(--primary);"></i>Medicine Name</label>
                    <input type="text" name="name" value="{{ medicine.name }}" class="form-control" required minlength="2">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-tags" style="margin-right: 8px; color: var(--secondary);"></i>Category</label>
                    <div style="position: relative;">
                        <select name="category" class="form-control" required style="cursor:pointer; appearance: none;">
                            <option value="tablet" {% if medicine.category == 'tablet' %}selected{% endif %}>Tablet</option>
                            <option value="syrup" {% if medicine.category == 'syrup' %}selected{% endif %}>Syrup</option>
                            <option value="ointment" {% if medicine.category == 'ointment' %}selected{% endif %}>Ointment</option>
                            <option value="equipment" {% if medicine.category == 'equipment' %}selected{% endif %}>Equipment</option>
                            <option value="kit" {% if medicine.category == 'kit' %}selected{% endif %}>Kit</option>
                            <option value="other" {% if medicine.category == 'other' %}selected{% endif %}>Other</option>
                        </select>
                        <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--muted); pointer-events: none;"></i>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-info-circle" style="margin-right: 8px; color: var(--accent);"></i>Description</label>
                <textarea name="details" class="form-control" required rows="4">{{ medicine.details }}</textarea>
            </div>
            
            <div class="grid-2">
                 <div class="form-group">
                    <label><i class="fas fa-dollar-sign" style="margin-right: 8px; color: #10b981;"></i>Price</label>
                    <input type="number" step="0.01" min="1" name="price" value="{{ medicine.price }}" class="form-control" required title="Price must be at least 1">
                </div>
                 <div class="form-group">
                    <label><i class="fas fa-boxes" style="margin-right: 8px; color: #f59e0b;"></i>Stock Quantity</label>
                    <input type="number" name="stock" min="0" value="{{ medicine.stock }}" class="form-control" required title="Stock cannot be negative">
                </div>
            </div>

            <div class="grid-2" style="align-items: center;">
                 <div class="form-group">
                    <label><i class="fas fa-image" style="margin-right: 8px; color: var(--primary);"></i>Update Image</label>
                    <input type="file" name="image" class="form-control" style="padding: 10px;">
                    {% if medicine.image %}
                    <p style="font-size: 0.8rem; color: var(--muted); margin-top: 0.5rem; display: flex; align-items: center;">
                        <i class="fas fa-check-circle" style="color: #4ade80; margin-right: 5px;"></i> Current: 
                        <a href="{{ medicine.image.url }}" target="_blank" style="color:var(--primary); margin-left: 5px;">View Image</a>
                    </p>
                    {% endif %}
                </div>
                 
                 <div class="form-group">
                    <label class="glass-card" style="display: flex; align-items: center; padding: 1rem; cursor: pointer; border: 1px solid rgba(56, 189, 248, 0.3);">
                        <input type="checkbox" name="prescription_required" id="pres" style="width: 20px; height: 20px; margin-right: 1rem; accent-color: var(--primary);" {% if medicine.prescription_required %}checked{% endif %}>
                        <span style="font-weight: 500;">Prescription Required</span>
                    </label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-block" style="margin-top: 1rem; padding: 1rem; font-size: 1.1rem;">
                <i class="fas fa-save" style="margin-right: 8px;"></i> Update Medicine
            </button>
        </form>
    </div>
</div>
{% endblock %}
